<?plantuml 1.2026.2beta1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="ACTIVITY" height="1132px" preserveAspectRatio="none" style="width:891px;height:1132px;background:#FFFFFF;" version="1.1" viewBox="0 0 891 1132" width="891px" zoomAndPan="magnify"><title>Firmware Main Loop (Tick-based, 20ms period on average)</title><defs/><g><g class="title" data-source-line="4"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="465.0625" x="211.7734" y="32.9951">Firmware Main Loop (Tick-based, 20ms period on average)</text></g><ellipse cx="649.3848" cy="57.2969" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="196.6426" x="551.0635" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="176.6426" x="561.0635" y="108.4355">Reset counter of passed time</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="196.6426" x="551.0635" y="233.668"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="176.6426" x="561.0635" y="254.8066">Reset counter of passed time</text><path d="M186.1235,333.3472 L186.1235,645.7378 A0,0 0 0 0 186.1235,645.7378 L554.3848,645.7378 A0,0 0 0 0 554.3848,645.7378 L554.3848,493.5425 L574.3848,489.5425 L554.3848,485.5425 L554.3848,343.3472 L544.3848,333.3472 L186.1235,333.3472 A0,0 0 0 0 186.1235,333.3472" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M544.3848,333.3472 L544.3848,343.3472 L554.3848,343.3472 L544.3848,333.3472" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267.4585" x="192.1235" y="350.4141">This is a blocking event; no other actions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.0464" x="192.1235" y="365.5469">are performed when the pump is on.</text><line style="stroke:#181818;stroke-width:1;" x1="186.1235" x2="554.3848" y1="373.6128" y2="373.6128"/><line style="stroke:#181818;stroke-width:1;" x1="186.1235" x2="554.3848" y1="375.6128" y2="375.6128"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="308.8262" x="192.1235" y="390.6797">Duration of how long the pump will be on when</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311.4795" x="192.1235" y="405.8125">watering is needed can be modified by the user</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.3906" x="192.1235" y="420.9453">via button (step below).</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="192.1235" y="436.0781">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312.6602" x="192.1235" y="451.2109">Level of soil humidity when the pump should be</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="323.0576" x="192.1235" y="466.3438">started is selected via potentiometer by the user.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344.189" x="192.1235" y="481.4766">The potentiometer and soil humidity sensor are then</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311.9175" x="192.1235" y="496.6094">compared by a comparator, the value is what is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.7646" x="192.1235" y="511.7422">fed to the microcontroller.</text><line style="stroke:#181818;stroke-width:1;" x1="186.1235" x2="554.3848" y1="519.8081" y2="519.8081"/><line style="stroke:#181818;stroke-width:1;" x1="186.1235" x2="554.3848" y1="521.8081" y2="521.8081"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290.4878" x="192.1235" y="536.875">Values of actual soil humidity and target soil</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="315.9102" x="192.1235" y="552.0078">humidity when watering should be activated are</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="339.7583" x="192.1235" y="567.1406">displayed on an LCD display which has its own ADC.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311.6445" x="192.1235" y="582.2734">This way we don't need an ADC on the PIC side.</text><line style="stroke:#181818;stroke-width:1;" x1="186.1235" x2="554.3848" y1="590.3394" y2="590.3394"/><line style="stroke:#181818;stroke-width:1;" x1="186.1235" x2="554.3848" y1="592.3394" y2="592.3394"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.4429" x="192.1235" y="607.4063">When the pump is on, time will pass,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="343.1289" x="192.1235" y="622.5391">so the tick procedure will take way more than 20ms,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316.4053" x="192.1235" y="637.6719">but for such a simple device this doesn't matter.</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="150" x="574.3848" y="472.5581"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="61.8926" x="584.3848" y="493.6968">Run pump</text><polygon fill="#F1F1F1" points="592.2712,287.6367,706.4983,287.6367,718.4983,299.6367,706.4983,311.6367,592.2712,311.6367,580.2712,299.6367,592.2712,287.6367" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="653.3848" y="321.8472">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="114.2271" x="592.2712" y="303.4448">Soil needs watering?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7017" x="718.4983" y="297.0425">no</text><polygon fill="#F1F1F1" points="649.3848,670.1401,661.3848,682.1401,649.3848,694.1401,637.3848,682.1401,649.3848,670.1401" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="607.4043,185.2656,691.3652,185.2656,703.3652,197.2656,691.3652,209.2656,607.4043,209.2656,595.4043,197.2656,607.4043,185.2656" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="653.3848" y="219.4761">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="83.9609" x="607.4043" y="201.0737">1 hour passed?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7017" x="703.3652" y="194.6714">no</text><polygon fill="#F1F1F1" points="649.3848,714.1401,661.3848,726.1401,649.3848,738.1401,637.3848,726.1401,649.3848,714.1401" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="150" x="574.3848" y="758.1401"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="64.2832" x="584.3848" y="779.2788">Wait 20ms</text><path d="M10,857.8193 L10,978.6162 A0,0 0 0 0 10,978.6162 L441.1602,978.6162 A0,0 0 0 0 441.1602,978.6162 L441.1602,922.2178 L461.1602,918.2178 L441.1602,914.2178 L441.1602,867.8193 L431.1602,857.8193 L10,857.8193 A0,0 0 0 0 10,857.8193" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M431.1602,857.8193 L431.1602,867.8193 L441.1602,867.8193 L431.1602,857.8193" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406.0278" x="16" y="874.8862">Pressing the button increases time pump on duration by 5sec.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="339.8662" x="16" y="890.019">If the value reaches 10*5sec it goes back to 1*5sec.</text><line style="stroke:#181818;stroke-width:1;" x1="10" x2="441.1602" y1="898.085" y2="898.085"/><line style="stroke:#181818;stroke-width:1;" x1="10" x2="441.1602" y1="900.085" y2="900.085"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302.1929" x="16" y="915.1519">Key debouncing is done on the hardware side.</text><line style="stroke:#181818;stroke-width:1;" x1="10" x2="441.1602" y1="923.2178" y2="923.2178"/><line style="stroke:#181818;stroke-width:1;" x1="10" x2="441.1602" y1="925.2178" y2="925.2178"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366.1074" x="16" y="940.2847">The second key which decides what is displayed on LCD</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300.6885" x="16" y="955.4175">is driven purely on the hardware side. The PIC</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370.5" x="16" y="970.5503">microcontroller is not aware of the existence of that key.</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="376.4492" x="461.1602" y="901.2334"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="356.4492" x="471.1602" y="922.3721">Update the value of when how long the pump should be on</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="287.1055" x="505.832" y="998.6162"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="267.1055" x="515.832" y="1019.7549">Update bargraph showing pump duration on</text><polygon fill="#F1F1F1" points="545.9026,812.1089,752.8669,812.1089,764.8669,824.1089,752.8669,836.1089,545.9026,836.1089,533.9026,824.1089,545.9026,812.1089" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="19.0083" x="653.3848" y="846.3193">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="206.9644" x="545.9026" y="827.917">Key is pressed but wasn't previously?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="13.7017" x="764.8669" y="821.5146">no</text><polygon fill="#F1F1F1" points="649.3848,1052.585,661.3848,1064.585,649.3848,1076.585,637.3848,1064.585,649.3848,1052.585" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="649.3848,141.2656,661.3848,153.2656,649.3848,165.2656,637.3848,153.2656,649.3848,141.2656" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="649.3848,1096.585,649.3848,1096.585,661.3848,1108.585,649.3848,1120.585,649.3848,1120.585,637.3848,1108.585,649.3848,1096.585" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="67.2969" y2="87.2969"/><polygon fill="#181818" points="645.3848,77.2969,649.3848,87.2969,653.3848,77.2969,649.3848,81.2969" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="311.6367" y2="472.5581"/><polygon fill="#181818" points="645.3848,462.5581,649.3848,472.5581,653.3848,462.5581,649.3848,466.5581" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="718.4983" x2="734.3848" y1="299.6367" y2="299.6367"/><polygon fill="#181818" points="730.3848,479.5425,734.3848,489.5425,738.3848,479.5425,734.3848,483.5425" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="734.3848" x2="734.3848" y1="299.6367" y2="682.1401"/><line style="stroke:#181818;stroke-width:1;" x1="734.3848" x2="661.3848" y1="682.1401" y2="682.1401"/><polygon fill="#181818" points="671.3848,678.1401,661.3848,682.1401,671.3848,686.1401,667.3848,682.1401" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="506.5269" y2="670.1401"/><polygon fill="#181818" points="645.3848,660.1401,649.3848,670.1401,653.3848,660.1401,649.3848,664.1401" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="267.6367" y2="287.6367"/><polygon fill="#181818" points="645.3848,277.6367,649.3848,287.6367,653.3848,277.6367,649.3848,281.6367" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="209.2656" y2="233.668"/><polygon fill="#181818" points="645.3848,223.668,649.3848,233.668,653.3848,223.668,649.3848,227.668" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="703.3652" x2="757.7061" y1="197.2656" y2="197.2656"/><polygon fill="#181818" points="753.7061,445.0581,757.7061,455.0581,761.7061,445.0581,757.7061,449.0581" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="757.7061" x2="757.7061" y1="197.2656" y2="726.1401"/><line style="stroke:#181818;stroke-width:1;" x1="757.7061" x2="661.3848" y1="726.1401" y2="726.1401"/><polygon fill="#181818" points="671.3848,722.1401,661.3848,726.1401,671.3848,730.1401,667.3848,726.1401" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="694.1401" y2="714.1401"/><polygon fill="#181818" points="645.3848,704.1401,649.3848,714.1401,653.3848,704.1401,649.3848,708.1401" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="738.1401" y2="758.1401"/><polygon fill="#181818" points="645.3848,748.1401,649.3848,758.1401,653.3848,748.1401,649.3848,752.1401" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="935.2021" y2="998.6162"/><polygon fill="#181818" points="645.3848,988.6162,649.3848,998.6162,653.3848,988.6162,649.3848,992.6162" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="836.1089" y2="901.2334"/><polygon fill="#181818" points="645.3848,891.2334,649.3848,901.2334,653.3848,891.2334,649.3848,895.2334" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="764.8669" x2="847.6094" y1="824.1089" y2="824.1089"/><polygon fill="#181818" points="843.6094,942.7021,847.6094,952.7021,851.6094,942.7021,847.6094,946.7021" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="847.6094" x2="847.6094" y1="824.1089" y2="1064.585"/><line style="stroke:#181818;stroke-width:1;" x1="847.6094" x2="661.3848" y1="1064.585" y2="1064.585"/><polygon fill="#181818" points="671.3848,1060.585,661.3848,1064.585,671.3848,1068.585,667.3848,1064.585" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="1032.585" y2="1052.585"/><polygon fill="#181818" points="645.3848,1042.585,649.3848,1052.585,653.3848,1042.585,649.3848,1046.585" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="792.1089" y2="812.1089"/><polygon fill="#181818" points="645.3848,802.1089,649.3848,812.1089,653.3848,802.1089,649.3848,806.1089" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="165.2656" y2="185.2656"/><polygon fill="#181818" points="645.3848,175.2656,649.3848,185.2656,653.3848,175.2656,649.3848,179.2656" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="661.3848" x2="865.6094" y1="1108.585" y2="1108.585"/><polygon fill="#181818" points="861.6094,660.3276,865.6094,650.3276,869.6094,660.3276,865.6094,656.3276" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="865.6094" x2="865.6094" y1="153.2656" y2="1108.585"/><line style="stroke:#181818;stroke-width:1;" x1="865.6094" x2="661.3848" y1="153.2656" y2="153.2656"/><polygon fill="#181818" points="671.3848,149.2656,661.3848,153.2656,671.3848,157.2656,667.3848,153.2656" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="1076.585" y2="1096.585"/><polygon fill="#181818" points="645.3848,1086.585,649.3848,1096.585,653.3848,1086.585,649.3848,1090.585" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.3848" x2="649.3848" y1="121.2656" y2="141.2656"/><polygon fill="#181818" points="645.3848,131.2656,649.3848,141.2656,653.3848,131.2656,649.3848,135.2656" style="stroke:#181818;stroke-width:1;"/><?plantuml-src XLHTQoGt47pNh-Ytx0PdOmVknRuFWit1SNTmN9puMIlrUeGrwa7Ix6G9-U-frepjzJfmnc2Fr5tTNLMjjwKU8hyt7BddLEcVho65VkplWgyTNRmv_zUy_NM9gQ56feyXzvFDJ5zjIFH5PA3LRN0FlsnjONz6lvttXGREGJn98hldREzvRKgrkPhBxrouafCnLSuaEnfiGHxLqFELoJomhIRiQ7L1dOnvkVwmfjfnejM1o_f789hzXuH8YTaNcYo2Ghf_YK5q-NrCD8pzS6MILAR8ksfkkr08lvQsKTm3qeZt8EQAaf0WFvDrDKWgP9G43BgJtAFsfDW8Q90A8MbZtk77t8pPQeessib4KO3w53c566dBobM3C8_zAePE06ndauRquiCku7jxQFbZGJjc7z3iM2i0LgNoWCWeqtfZp1Uq7hLgKJQwiGy-rCD9fmKqHw_miqI0H-42GpZzNz47q9CmGSzAzr7n3VZYaskR_4czmga8Ba2N2c2Sz0C-sXYMvYzR9PyrtBsD8siBKsUh_ZKxLLRQPHzS5YUfPebHwpU2_zAKeeD2cz76a_hQ4IQxXsNQXNd9n1FVpqoen7khuslJneSoH7lWsT0m_VKDBMU02AwZpi8r5IrCYNw_kTxCFfhqdibB-gasAJKPrmgZqtpxT4qbU5x6k7ljeBDcwTaZwl4pY3GpKR5oD80CzcDU8gfzu5QqbyOrgkas8Wd-8FYKoeXcBOhs0rRPypuu3KGjBroqpTxMgiGoIDErmCjGc5P9rdeKTg--B-zigAtEl7cV-Q2z3vdRIchboJPe7Es3Z2KUNgtYduC7tKVwGyicpkjzULP9ql7cVjE2OObSzY4abndFKfbfRFauzeyB2GE-AUmsP3xjZeeZntL8kZZ_MQ-XBDs37jfQS0udNhJZHJMTr_CMRv5RbXPwywF4dSs-lPP7EklE85_0y0C_EiYpGyIpwrzuJWrdz307F4QO8tCy_7y9kbsCPKvsfJqdKicsM9ddvRy3depabWEKHaT7uZyfiyN-P3jqIl-aSpOkduXKAKwDGSjhhWF2R2jQ_mS0?></g></svg>